<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>City Metro | BrickPass</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- QR -->
<script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
</head>

<body>
<h1>City Metro</h1>
<h3>Create BrickPass</h3>

<form id="form">
  Name: <input id="name" required><br><br>
  Singles: <input id="singles" type="number" value="1" min="0"><br>
  Day Passes: <input id="day" type="number" value="0" min="0"><br>
  Week Passes: <input id="week" type="number" value="0" min="0"><br><br>
  <button>Create Ticket</button>
</form>

<div id="result" hidden>
  <h2>BrickPass Created âœ…</h2>
  <canvas id="qr"></canvas>
  <p>Ticket ID: <span id="ticketId"></span></p>
</div>

<script>
/* ðŸ”¥ FIREBASE CONFIG â€” CHANGE THIS ONLY */
const firebaseConfig = {
  apiKey: "AIzaSyANne8sRMI_iG_8DMh1-SzQef4UbdBzBZ0",
  authDomain: "city-metro-brickpass.firebaseapp.com",
  projectId: "city-metro-brickpass",
  storageBucket: "city-metro-brickpass.firebasestorage.app",
  messagingSenderId: "88566855284",
  appId: "1:88566855284:web:a28ed3c18708da927d0321"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* CREATE TICKET */
document.getElementById("form").onsubmit = async e => {
  e.preventDefault();

  const id = "CM-" + Math.floor(Math.random() * 1000000);

  await db.collection("tickets").doc(id).set({
    name: name.value,
    singles: +singles.value,
    dayPasses: +day.value,
    weekPasses: +week.value,
    activePass: null,
    activatedAt: null
  });

  new QRious({
    element: document.getElementById("qr"),
    value: id,
    size: 220
  });

  ticketId.textContent = id;
  form.hidden = true;
  result.hidden = false;
};
</script>
</body>
</html>
